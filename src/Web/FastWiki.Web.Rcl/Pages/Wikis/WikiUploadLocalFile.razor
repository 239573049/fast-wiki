@using FastWiki.Web.Rcl.Components.Upload
@using FastWiki.Infrastructure.Common.Helper
<MDialog @bind-Value="_visible"
         Fullscreen
         Transition="dialog-bottom-transition">
    <ActivatorContent>
        <MListItem Link
                   @attributes="@context.Attrs">
            <MListItemIcon>
                <MIcon>mdi-file-chart-outline</MIcon>
            </MListItemIcon>
            <MListItemContent>
                <MListItemTitle>本地文件</MListItemTitle>
            </MListItemContent>
        </MListItem>
    </ActivatorContent>
    <ChildContent>
        <MCard>
            <MToolbar Dark
                      Color="primary">
                <MToolbarTitle>上传本地文件</MToolbarTitle>
                <MSpacer></MSpacer>
                <MToolbarItems>
                    <MButton Icon
                             Dark
                             OnClick="() => _visible = false">
                        <MIcon>mdi-close</MIcon>
                    </MButton>
                </MToolbarItems>
            </MToolbar>
            <MDivider></MDivider>
            <MStepper Value="_step">
                <MStepperHeader>
                    <MStepperStep Step="1" Complete="_step>1">
                        选择文件
                    </MStepperStep>
                    <MDivider></MDivider>
                    <MStepperStep Step="2" Complete="_step>2">
                        数据处理
                    </MStepperStep>
                    <MDivider></MDivider>
                    <MStepperStep Step="3">
                        上传数据
                    </MStepperStep>
                </MStepperHeader>

                <MStepperItems>
                    <MStepperContent Step="1">
                        <MCard Outlined Class="mb-12">
                            <DropUpload Multiple OnUploadChanged="UploadChanged">
                                <div class="flex flex-col items-center justify-center h-full upload-item">
                                    <MIcon Size="48">mdi-file-upload</MIcon>
                                    <div class="text-h6">拖拽文件到此处</div>
                                    <div class="text-caption">或点击上传</div>
                                </div>
                            </DropUpload>
                            <MCardActions>
                                @foreach (var item in _files)
                                {
                                    <MChip Class="ma-2"
                                           Close
                                           Color="green"
                                           TextColor="white"
                                           OnCloseClick="()=>RemoveFile(item)">
                                        @item.Name
                                        <span style="font-size:10px;margin-left:4px;">
                                            文件大小：@StringHelper.FormatBytes(item.Size)
                                        </span>
                                    </MChip>
                                }
                                <MSpacer></MSpacer>
                                <MButton Color="primary" OnClick="() => _step = 2">下一步</MButton>
                            </MCardActions>
                        </MCard>
                    </MStepperContent>
                    <MStepperContent Step="2">
                        <MCard Outlined Class="mb-12" Height="@("calc(100vh - 230px)")">
                            <div style="display: flex;">
                                <div style="margin:8px;width:15%;">
                                    <div style="margin-top:8px;">
                                        <p>训练模式</p>
                                        <MRadioGroup @bind-Value="_trainingPattern"
                                                     Row>
                                            <MRadio Label="直接拆分"
                                                    Value="TrainingPattern.Subsection">
                                            </MRadio>
                                            <MRadio Label="问答拆分"
                                                    Value="TrainingPattern.QA">
                                            </MRadio>
                                        </MRadioGroup>
                                    </div>
                                    <div style="margin-top:8px;">
                                        <p>处理方式</p>
                                        <MRadioGroup @bind-Value="_processMode"
                                                     Row>
                                            <MRadio Label="自动处理"
                                                    Value="ProcessMode.Auto">
                                            </MRadio>
                                            <MRadio Label="自定义处理"
                                                    Value="ProcessMode.Custom">
                                            </MRadio>
                                        </MRadioGroup>
                                    </div>
                                    @if (_trainingPattern == TrainingPattern.Subsection && _processMode == ProcessMode.Custom)
                                    {
                                        <div style="margin-top:15px;">

                                            <MTextField Outlined Label="Limit Input" NumberProps="@(prop => { prop.Min = 200; prop.Max = 2048; prop.Step = 1; })" Type="number" TValue="int" @bind-Value="subsection" Label="理想分段长度"></MTextField>

                                        </div>
                                    }
                                    <MButton Block Color="primary" OnClick="Preview">预览</MButton>
                                </div>
                                <div style="flex: 1;">第二个div</div>
                            </div>
                            <MCardActions>
                                <MSpacer></MSpacer>
                                <MButton Color="primary" OnClick="() => _step = 1">上一步</MButton>
                                <MButton Color="primary" OnClick="() => _step = 3">下一步</MButton>
                            </MCardActions>
                        </MCard>
                    </MStepperContent>
                    <MStepperContent Step="3">
                        <MCard Outlined Class="mb-12" Height="200">
                            <MCardActions>
                                <MSpacer></MSpacer>
                                <MButton Color="primary" OnClick="()=>_step=2">上一步</MButton>
                                <MButton Color="primary">完成</MButton>
                            </MCardActions>
                        </MCard>
                    </MStepperContent>
                </MStepperItems>
            </MStepper>
        </MCard>
    </ChildContent>
</MDialog>